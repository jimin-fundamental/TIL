# 20240427: CAP 정리와 메일서버 구현을 위한 고려사항 고민

## 💡 Key Context
> 오늘은 CAP 이론과 분산 시스템에서의 데이터 안정성을 다시 한번 정리하며, 메일서버에서 큐 안정성을 위해 어떤 방식을 적용할지 고민하는 시간을 가졌음. 특히, 데이터 일관성과 가용성 사이의 균형, 그리고 네트워크 장애 상황에서의 대응 방안이 중요하다고 느꼈음.

## 🔍 Deep Dive & Reasoning
- CAP 정리에서 일관성(Consistency), 가용성(Availability), 파티션 내구성(Partition Tolerance) 중 두 가지를 선택해야 하는데, 이 선택이 꽤 민감하게 작용함.
- 예를 들어, 메일 서버는 가용성이 중요한데, 큐가 비워지지 않거나 메시지 유실이 생기면 이용자 경험이 떨어질 것 같음. 따라서, 일관성과 가용성을 최우선으로 선택하는 쪽이 자연스럽다는 생각이 들었음.
- 그러나 네트워크 장애가 발생했을 때, 데이터의 일관성을 포기하거나 가용성을 포기하는 선택은 각각의 장단점이 있는데, 어떤 상황에서 어떤 선택이 최선일까 하는 고민이 생김.
- 디비 저장 방식을 통해 큐의 안정성을 확보하는 것도 방법이지만, 이게 정말 지속적이고 신뢰성 있게 작동하려면 어떤 설계 원리가 필요할지 열심히 떠올려보고 있음.

## 🛠️ Troubleshooting & Insight
- 처음에는 비동기 처리로 메시지 큐를 관리하는 게 복잡하게 느껴졌지만, 로그와 메시지 상태를 기록하는 방식을 도입하니 문제점을 찾기 수월했음.
- 팀 피드백을 듣고 나니, 결국 시스템 설계시 어떤 특성을 우선순위로 두는지 명확히 하는 게 핵심임을 깨달았음. 또한, 장애 상황에서도 무조건 가용성에 집중하는 게 아니고, 일관성과의 적절한 균형이 중요함.
- 내가 또 놓쳤던 부분은, 네트워크 장애 시 메시지 손실 방지와 재전송 전략이었음. 이걸 좀 더 구체적으로 계획해야겠다는 생각이 든다.

## 🎯 Next Step
- 메시지 큐의 재전송 전략과 디비에 저장하는 경우의 장단점 비교를 더 깊게 분석해볼 것. 
- 실제 시스템에 적용할 때 어떤 선택이 실무적으로 더 효과적인지 실험하거나 사례 연구를 찾아볼 것.